require 'rubygems'
 require 'rake'
 require 'rdoc'
 require 'date'
 require 'yaml'
 require 'tmpdir'
 require 'jekyll'

 desc "Generate blog files"
 task :generate do
   Jekyll::Site.new(Jekyll.configuration({
     "source"      => ".",
     "destination" => "_site"
   })).process
 end


 desc "Generate and publish site"
 task :publish => [:generate] do
   Dir.mktmpdir do |tmp|
     system "bundle exec jekyll build"
     message = "Site updated at #{Time.now.utc}"
     system "git add ."
     system "mv _site/* #{tmp}"
    ## commit to source
     system "git commit -am #{message.shellescape}"
     system "git push"
     system "git checkout -B master"
     system "rm -rf *"
     system "mv #{tmp}/* ."
     system "git add ."
     ## commit to master
     system "git commit -am #{message.shellescape}"
     system "git push origin master --force"
     system "git checkout source"
     system "echo yolo"
   end
 end

task :default => :publish
